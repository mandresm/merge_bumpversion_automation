# ESM-Tests in check mode for all computers
# =========================================
# Some comments here

name: esm_tests

# Triggers the workflow on a push or a pull
on:
  push:
    branches: ["*"]
  pull_request:
    branches: {}

jobs:
  ollie:
    # Containers must run in Linux based operating systems
    runs-on: ubuntu-latest
    # Docker Hub image that `container-job` executes in
    env:
      LC_ALL: en_US.UTF-8
      LANG: en_US.UTF-8
    container:
      image: koldunovn/esm_test:latest
      options: --hostname ollie1

    # Service containers to run with `gfortran_ubuntu`
    steps:
    # NK: this changes working directory to fesom2
    - uses: actions/checkout@v2

    - name: add to the path
      run: |
        echo "$HOME/.local/bin" >> $GITHUB_PATH
    - name: install esm-tools
      run: |
        ./install.sh
    - name: Run Pytest
      run: |
        pip install pytest
        pytest -v .
    - name: run esm_master first time
      run: |
        yes Y | esm_master
    - name: run esm_master second time
      run: |
        esm_master
